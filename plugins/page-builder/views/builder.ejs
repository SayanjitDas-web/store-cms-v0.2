<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Page Builder - <%= page.title %>
    </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        .builder-canvas {
            min-height: calc(100vh - 64px);
        }

        .block-ghost {
            opacity: 0.5;
            background: #e0e7ff;
        }

        .block-selected {
            outline: 2px solid #4f46e5;
        }

        [contenteditable]:focus {
            outline: none;
        }

        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>

<body class="bg-gray-100 font-sans text-gray-900 overflow-hidden">

    <!-- Header -->
    <header class="h-16 bg-white border-b border-gray-200 flex justify-between items-center px-6 z-50 relative">
        <div class="flex items-center space-x-4">
            <a href="/admin/pages/edit/<%= page._id %>" class="text-gray-500 hover:text-gray-700">
                <i class="bi bi-arrow-left text-xl"></i>
            </a>
            <h1 class="text-lg font-bold">Page Builder: <span class="text-gray-500 font-normal">
                    <%= page.title %>
                </span></h1>
        </div>
        <div class="flex items-center space-x-3">

            <button id="saveBtn"
                class="px-6 py-2 bg-indigo-600 text-white text-sm font-bold rounded-lg hover:bg-indigo-700 transition-shadow shadow-sm">
                Save Changes
            </button>
        </div>
    </header>

    <div class="flex h-[calc(100vh-64px)]">
        <!-- Sidebar: Blocks -->
        <aside class="w-72 bg-white border-r border-gray-200 flex flex-col pt-4 overflow-y-auto">
            <div class="px-4 mb-6">
                <h3 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-4">Elements</h3>
                <div id="blockPalette" class="grid grid-cols-2 gap-3">
                    <!-- Blocks will be injected here via JS -->
                </div>
            </div>

            <div id="settingsPanel" class="px-4 mt-auto border-t border-gray-100 py-6 hidden">
                <h3 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-4">Block Settings</h3>
                <div id="settingsContent" class="space-y-4">
                    <!-- Dynamic settings based on selected block -->
                </div>
            </div>
        </aside>

        <!-- Canvas -->
        <main class="flex-grow overflow-y-auto bg-gray-50 p-12 hide-scrollbar">
            <div id="canvas"
                class="max-w-4xl mx-auto bg-white shadow-2xl min-h-full rounded-lg overflow-hidden flex flex-col">
                <!-- Blocks will be dropped here -->
                <div id="dropZone"
                    class="flex-grow flex flex-col items-center justify-center p-12 border-2 border-dashed border-gray-200 rounded-lg m-8 text-gray-400">
                    <i class="bi bi-plus-circle text-4xl mb-4 text-gray-200"></i>
                    <p>Drag blocks here to start building</p>
                </div>
            </div>
        </main>
    </div>

    <!-- Hidden Initial Data -->
    <div id="initialBlocks" class="hidden"><%- JSON.stringify(page.blocks || []) %></div>

    <div id="availablePages" class="hidden"><%- JSON.stringify(pages || []) %></div>

    <script src="/js/dashboard.js"></script>
    <%- builderScripts %>
        <script src="/page-builder-assets/js/builder.js"></script>
</body>


</html>