<%- include('../../../../src/views/partials/header_frontend') %>

    <div class="container mx-auto px-4 md:px-6 py-8">
        <div class="flex items-center justify-between mb-8">
            <h1 class="text-3xl font-bold text-gray-900">My Orders</h1>
            <a href="/shop" class="text-indigo-600 hover:text-indigo-800 font-medium text-sm flex items-center">
                <i class="bi bi-arrow-left mr-1"></i> Continue Shopping
            </a>
        </div>

        <% if (orders.length===0) { %>
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-12 text-center">
                <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="bi bi-bag text-2xl text-gray-400"></i>
                </div>
                <h2 class="text-xl font-semibold text-gray-800 mb-2">No orders found</h2>
                <p class="text-gray-500 mb-6">Looks like you haven't placed any orders yet.</p>
                <a href="/shop"
                    class="inline-block bg-indigo-600 text-white px-6 py-2.5 rounded-lg hover:bg-indigo-700 transition-colors shadow-sm font-medium">
                    Start Shopping
                </a>
            </div>
            <% } else { %>
                <div class="space-y-6">
                    <% orders.forEach(order=> { %>
                        <div
                            class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden transition-all hover:shadow-md">
                            <!-- Order Header -->
                            <div
                                class="bg-gray-50/50 px-6 py-4 border-b border-gray-100 flex flex-col md:flex-row md:items-center justify-between gap-4">
                                <div class="flex flex-col md:flex-row md:items-center gap-2 md:gap-6">
                                    <div>
                                        <span class="text-xs text-gray-500 uppercase font-semibold tracking-wide">Order
                                            Placed</span>
                                        <div class="font-medium text-gray-800">
                                            <%= new Date(order.createdAt).toLocaleDateString() %>
                                        </div>
                                    </div>
                                    <div>
                                        <span class="text-xs text-gray-500 uppercase font-semibold tracking-wide">Order
                                            #</span>
                                        <div class="font-medium text-gray-800">
                                            <%= order._id.toString().slice(-6).toUpperCase() %>
                                        </div>
                                    </div>
                                </div>

                                <div class="flex items-center gap-4">
                                    <div class="text-right">
                                        <span
                                            class="text-xs text-gray-500 uppercase font-semibold tracking-wide block">Total</span>
                                        <span class="font-bold text-gray-900 text-lg">$<%= order.totalAmount.toFixed(2)
                                                %></span>
                                    </div>
                                    <div class="h-8 w-px bg-gray-200 hidden md:block"></div>
                                    <span class="px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide
                                <%= order.status === 'completed' ? 'bg-green-100 text-green-700 border border-green-200' : 
                                   order.status === 'cancelled' ? 'bg-red-50 text-red-700 border border-red-100' : 
                                   order.status === 'shipped' ? 'bg-blue-100 text-blue-700 border border-blue-200' :
                                   'bg-amber-50 text-amber-700 border border-amber-100' %>">
                                        <%= order.status %>
                                    </span>
                                </div>
                            </div>

                            <!-- Order Items -->
                            <div class="p-6">
                                <ul class="divide-y divide-gray-100">
                                    <% order.items.forEach(item=> { %>
                                        <li class="py-4 first:pt-0 last:pb-0 flex justify-between items-center">
                                            <div class="flex items-center gap-4">
                                                <div
                                                    class="w-16 h-16 bg-gray-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                                    <i class="bi bi-box-seam text-gray-400 text-2xl"></i>
                                                </div>
                                                <div>
                                                    <h4 class="font-medium text-gray-900">
                                                        <%= item.name %>
                                                    </h4>
                                                    <p class="text-sm text-gray-500">Qty: <%= item.quantity %>
                                                    </p>
                                                </div>
                                            </div>
                                            <span class="font-medium text-gray-700">$<%= (item.price *
                                                    item.quantity).toFixed(2) %></span>
                                        </li>
                                        <% }) %>
                                </ul>
                            </div>

                            <!-- Actions Footer -->
                            <% if (order.isCancellable || ['cancelled', 'completed' , 'refunded'
                                ].includes(order.status)) { %>
                                <div class="bg-gray-50 px-6 py-4 border-t border-gray-100 flex justify-end gap-3">
                                    <% if (order.isCancellable) { %>
                                        <form action="/orders/<%= order._id %>/cancel" method="POST"
                                            onsubmit="return confirm('Are you sure you want to cancel this order? This action cannot be undone.');">
                                            <button type="submit"
                                                class="text-red-600 bg-white border border-red-200 hover:bg-red-50 hover:border-red-300 px-4 py-2 rounded-lg font-medium text-sm transition-colors flex items-center shadow-sm">
                                                <i class="bi bi-x-circle mr-2"></i> Cancel Order
                                            </button>
                                        </form>
                                        <% } %>

                                            <% if (['cancelled', 'completed' , 'refunded' ].includes(order.status)) { %>
                                                <form action="/orders/<%= order._id %>/delete" method="POST"
                                                    onsubmit="return confirm('Remove this order from your history?');">
                                                    <button type="submit"
                                                        class="text-gray-500 hover:text-gray-700 font-medium text-sm flex items-center px-4 py-2 hover:bg-gray-100 rounded-lg transition-colors">
                                                        <i class="bi bi-trash mr-2"></i> Remove from History
                                                    </button>
                                                </form>
                                                <% } %>
                                </div>
                                <% } %>

                                    <% if (order.status==='cancelled' ) { %>
                                        <div
                                            class="bg-red-50 px-6 py-3 border-t border-red-100 text-sm text-red-600 flex items-center">
                                            <i class="bi bi-info-circle mr-2"></i>
                                            This order was cancelled on <%= new Date(order.history.find(h=> h.status ===
                                                'cancelled')?.updatedAt || order.updatedAt).toLocaleDateString() %>.
                                        </div>
                                        <% } %>
                        </div>
                        <% }) %>
                </div>
                <% } %>
    </div>

    <%- include('../../../../src/views/partials/footer_frontend') %>