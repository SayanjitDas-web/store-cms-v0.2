<%- include('../../../src/views/partials/header') %>

    <div class="container mx-auto px-6 py-8">
        <div class="flex justify-between items-center mb-8">
            <div>
                <h1 class="text-2xl font-bold text-gray-800">Compose Email Marketing</h1>
                <p class="text-gray-600">Send personalized messages to your customers.</p>
            </div>
            <div class="flex space-x-3">
                <a href="/admin/email-marketing/settings"
                    class="bg-white text-gray-700 border border-gray-300 px-4 py-2 rounded-lg hover:bg-gray-50 flex items-center transition-all">
                    <i class="bi bi-gear mr-2"></i> SMTP Settings
                </a>
            </div>
        </div>

        <% if (locals.success) { %>
            <div class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4 mb-6 shadow-sm">
                <p>
                    <%= success %>
                </p>
            </div>
            <% } %>

                <% if (locals.error) { %>
                    <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6 shadow-sm">
                        <p>
                            <%= error %>
                        </p>
                    </div>
                    <% } %>

                        <% if (!settings.SMTP_HOST) { %>
                            <div class="bg-yellow-50 border-l-4 border-yellow-400 text-yellow-700 p-4 mb-8">
                                <div class="flex items-center">
                                    <i class="bi bi-exclamation-triangle-fill text-xl mr-3"></i>
                                    <div>
                                        <p class="font-bold">SMTP is not configured!</p>
                                        <p>You need to configure your SMTP settings before you can send emails. <a
                                                href="/admin/email-marketing/settings"
                                                class="underline font-semibold">Configure now</a></p>
                                    </div>
                                </div>
                            </div>
                            <% } %>

                                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                                    <!-- Main Form -->
                                    <div class="lg:col-span-2">
                                        <div
                                            class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                                            <form action="/admin/email-marketing/send" method="POST"
                                                class="p-6 space-y-6">
                                                <div>
                                                    <label
                                                        class="block text-sm font-semibold text-gray-700 mb-2">Recipients</label>
                                                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                                        <div class="flex items-center mb-3">
                                                            <input type="checkbox" id="selectAll"
                                                                class="w-4 h-4 text-indigo-600 rounded">
                                                            <label for="selectAll"
                                                                class="ml-2 text-sm font-medium text-gray-700">Select
                                                                All Customers (<%= customers.length %>)</label>
                                                        </div>
                                                        <div class="max-h-48 overflow-y-auto space-y-2 pr-2">
                                                            <% customers.forEach(customer=> { %>
                                                                <div class="flex items-center">
                                                                    <input type="checkbox" name="recipients"
                                                                        value="<%= customer._id %>"
                                                                        class="recipient-checkbox w-4 h-4 text-indigo-600 rounded">
                                                                    <label class="ml-2 text-sm text-gray-600">
                                                                        <%= (customer.firstName || '' ) %>
                                                                            <%= (customer.lastName || '' ) %> (<%=
                                                                                    customer._id %>)
                                                                    </label>
                                                                </div>
                                                                <% }) %>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div>
                                                    <label
                                                        class="block text-sm font-semibold text-gray-700 mb-2">Subject</label>
                                                    <input type="text" name="subject"
                                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none"
                                                        placeholder="Enter email subject" required>
                                                </div>

                                                <div>
                                                    <label
                                                        class="block text-sm font-semibold text-gray-700 mb-2">Message
                                                        Content (HTML Supported)</label>
                                                    <textarea name="message" rows="12"
                                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none font-mono"
                                                        placeholder="Write your email content here..."
                                                        required></textarea>
                                                </div>

                                                <div class="pt-4 border-t border-gray-100">
                                                    <button type="submit"
                                                        class="w-full bg-indigo-600 text-white px-6 py-4 rounded-xl font-bold hover:bg-indigo-700 transition-all shadow-lg flex items-center justify-center">
                                                        <i class="bi bi-send-fill mr-2"></i> Send Email Blast
                                                    </button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>

                                    <!-- Sidebar / Tips -->
                                    <div class="space-y-6">
                                        <div class="bg-indigo-50 rounded-xl p-6 border border-indigo-100">
                                            <h3 class="font-bold text-indigo-900 mb-4">Tips for Better Engagement</h3>
                                            <ul class="space-y-3 text-sm text-indigo-800">
                                                <li class="flex items-start">
                                                    <i class="bi bi-check2-circle mr-2 mt-0.5"></i> Keep subjects short
                                                    and urgent.
                                                </li>
                                                <li class="flex items-start">
                                                    <i class="bi bi-check2-circle mr-2 mt-0.5"></i> Use clear calls to
                                                    action (buttons).
                                                </li>
                                                <li class="flex items-start">
                                                    <i class="bi bi-check2-circle mr-2 mt-0.5"></i> Test emails on
                                                    mobile devices first.
                                                </li>
                                            </ul>
                                        </div>

                                        <div class="bg-gray-50 rounded-xl p-6 border border-gray-200">
                                            <h3 class="font-bold text-gray-800 mb-4 font-semibold">Active Integration
                                            </h3>
                                            <p class="text-sm text-gray-600 mb-4">This plugin is reading data from the
                                                <strong>Ecommerce Core</strong> Order system.</p>
                                            <div class="flex items-center text-green-600 text-sm font-bold">
                                                <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                                                Ecommerce Connection Live
                                            </div>
                                        </div>
                                    </div>
                                </div>
    </div>

    <script>
        document.getElementById('selectAll').addEventListener('change', function () {
            const checkboxes = document.querySelectorAll('.recipient-checkbox');
            checkboxes.forEach(cb => cb.checked = this.checked);
        });
    </script>

    <%- include('../../../src/views/partials/footer') %>