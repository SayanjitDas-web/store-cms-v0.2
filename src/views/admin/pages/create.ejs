<%- include('../../partials/header') %>

    <div class="mb-6">
        <h1 class="text-3xl font-bold text-gray-800">Create Page</h1>
    </div>

    <% if (typeof error !=='undefined' ) { %>
        <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4" role="alert">
            <span class="block sm:inline">
                <%= error %>
            </span>
        </div>
        <% } %>

            <div class="bg-white rounded-lg shadow p-6">
                <form action="/admin/pages" method="POST" enctype="multipart/form-data">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

                        <!-- Main Content (Left Column) -->
                        <div class="lg:col-span-2 space-y-6">
                            <!-- Title -->
                            <div>
                                <label for="title" class="sr-only">Title</label>
                                <input type="text"
                                    class="w-full px-4 py-3 text-2xl font-bold text-gray-900 placeholder-gray-400 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-shadow shadow-sm"
                                    id="title" name="title" required placeholder="Enter page title here..."
                                    value="<%= typeof input !== 'undefined' ? input.title : '' %>">
                            </div>

                            <!-- Content Editor -->
                            <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                                <div class="p-4 border-b border-gray-200 bg-gray-50 flex justify-between items-center">
                                    <label class="font-semibold text-gray-700">Page Content</label>
                                </div>

                                <!-- Custom WYSIWYG Editor -->
                                <link rel="stylesheet" href="/css/editor.css">
                                <div
                                    class="editor-toolbar border-b border-gray-200 bg-white p-2 flex flex-wrap gap-1 sticky top-0 z-10">
                                    <button type="button"
                                        class="p-1.5 hover:bg-gray-100 rounded text-gray-600 transition-colors"
                                        onclick="formatDoc('bold')" title="Bold"><i
                                            class="bi bi-type-bold"></i></button>
                                    <button type="button"
                                        class="p-1.5 hover:bg-gray-100 rounded text-gray-600 transition-colors"
                                        onclick="formatDoc('italic')" title="Italic"><i
                                            class="bi bi-type-italic"></i></button>
                                    <button type="button"
                                        class="p-1.5 hover:bg-gray-100 rounded text-gray-600 transition-colors"
                                        onclick="formatDoc('underline')" title="Underline"><i
                                            class="bi bi-type-underline"></i></button>
                                    <button type="button"
                                        class="p-1.5 hover:bg-gray-100 rounded text-gray-600 transition-colors"
                                        onclick="formatDoc('strikeThrough')" title="Strikethrough"><i
                                            class="bi bi-type-strikethrough"></i></button>
                                    <div class="border-r border-gray-300 mx-1 my-1"></div>
                                    <button type="button"
                                        class="p-1.5 hover:bg-gray-100 rounded text-gray-600 transition-colors"
                                        onclick="formatDoc('formatBlock', 'h2')" title="Heading 2"><i
                                            class="bi bi-type-h2"></i></button>
                                    <button type="button"
                                        class="p-1.5 hover:bg-gray-100 rounded text-gray-600 transition-colors"
                                        onclick="formatDoc('formatBlock', 'h3')" title="Heading 3"><i
                                            class="bi bi-type-h3"></i></button>
                                    <button type="button"
                                        class="p-1.5 hover:bg-gray-100 rounded text-gray-600 transition-colors"
                                        onclick="formatDoc('formatBlock', 'p')" title="Paragraph"><i
                                            class="bi bi-paragraph"></i></button>
                                    <button type="button"
                                        class="p-1.5 hover:bg-gray-100 rounded text-gray-600 transition-colors"
                                        onclick="formatDoc('formatBlock', 'blockquote')" title="Quote"><i
                                            class="bi bi-blockquote-left"></i></button>
                                    <div class="border-r border-gray-300 mx-1 my-1"></div>
                                    <button type="button"
                                        class="p-1.5 hover:bg-gray-100 rounded text-gray-600 transition-colors"
                                        onclick="formatDoc('insertUnorderedList')" title="Bullet List"><i
                                            class="bi bi-list-ul"></i></button>
                                    <button type="button"
                                        class="p-1.5 hover:bg-gray-100 rounded text-gray-600 transition-colors"
                                        onclick="formatDoc('insertOrderedList')" title="Numbered List"><i
                                            class="bi bi-list-ol"></i></button>
                                    <div class="border-r border-gray-300 mx-1 my-1"></div>
                                    <button type="button"
                                        class="p-1.5 hover:bg-gray-100 rounded text-gray-600 transition-colors"
                                        onclick="formatDoc('justifyLeft')" title="Align Left"><i
                                            class="bi bi-text-left"></i></button>
                                    <button type="button"
                                        class="p-1.5 hover:bg-gray-100 rounded text-gray-600 transition-colors"
                                        onclick="formatDoc('justifyCenter')" title="Align Center"><i
                                            class="bi bi-text-center"></i></button>
                                    <button type="button"
                                        class="p-1.5 hover:bg-gray-100 rounded text-gray-600 transition-colors"
                                        onclick="formatDoc('justifyRight')" title="Align Right"><i
                                            class="bi bi-text-right"></i></button>
                                    <div class="border-r border-gray-300 mx-1 my-1"></div>
                                    <button type="button"
                                        class="p-1.5 hover:bg-gray-100 rounded text-gray-600 transition-colors"
                                        onclick="let url = prompt('Enter link URL'); if(url) formatDoc('createLink', url);"
                                        title="Link"><i class="bi bi-link"></i></button>
                                    <button type="button"
                                        class="p-1.5 hover:bg-gray-100 rounded text-gray-600 transition-colors"
                                        onclick="formatDoc('unlink')" title="Unlink"><i
                                            class="bi bi-link-45deg"></i></button>
                                    <button type="button"
                                        class="p-1.5 hover:bg-gray-100 rounded text-gray-600 transition-colors"
                                        onclick="document.execCommand('removeFormat')" title="Clear Formatting"><i
                                            class="bi bi-eraser"></i></button>
                                </div>

                                <div id="editor"
                                    class="editor-content p-6 min-h-[500px] focus:outline-none prose max-w-none"
                                    contenteditable="true"><%- typeof input !=='undefined' ? input.content : '' %></div>
                                <textarea name="content" id="content"
                                    class="hidden"><%= typeof input !== 'undefined' ? input.content : '' %></textarea>
                            </div>
                            <script src="/js/editor.js"></script>
                        </div>

                        <!-- Sidebar (Right Column) -->
                        <div class="space-y-6">

                            <!-- Publish Card -->
                            <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
                                <div class="bg-gray-50 px-4 py-3 border-b border-gray-200">
                                    <h3 class="font-semibold text-gray-700">Publish</h3>
                                </div>
                                <div class="p-4 space-y-4">
                                    <!-- Status -->
                                    <div>
                                        <label for="status"
                                            class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                                        <select id="status" name="status"
                                            class="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                                            <option value="draft">Draft</option>
                                            <option value="published" <%=typeof input==='undefined' ? 'selected' :
                                                (input.status==='published' ? 'selected' : '' ) %>>Published</option>
                                        </select>
                                    </div>

                                    <!-- Template -->
                                    <div>
                                        <label for="template"
                                            class="block text-sm font-medium text-gray-700 mb-1">Template</label>
                                        <select id="template" name="template"
                                            class="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                                            <option value="default">Default</option>
                                            <option value="full-width">Full Width</option>
                                        </select>
                                    </div>

                                    <!-- Actions -->
                                    <div class="pt-4 border-t border-gray-100 flex justify-between items-center">
                                        <a href="/admin/pages"
                                            class="text-sm text-gray-500 hover:text-gray-700 font-medium">Cancel</a>
                                        <div class="flex space-x-2">
                                            <button type="submit"
                                                class="inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors">
                                                Publish Page
                                            </button>
                                            <button type="submit" name="launchBuilder" value="true"
                                                class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors">
                                                <i class="bi bi-grid-1x2-fill mr-2"></i>
                                                Create with Builder
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Display Settings -->
                            <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
                                <div class="bg-gray-50 px-4 py-3 border-b border-gray-200">
                                    <h3 class="font-semibold text-gray-700">Display Settings</h3>
                                </div>
                                <div class="p-4 space-y-4">
                                    <div class="flex items-center">
                                        <input type="hidden" name="showTitle" value="false">
                                        <input type="checkbox" name="showTitle" id="showTitle" value="true"
                                            class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"
                                            checked>
                                        <label for="showTitle" class="ml-2 block text-sm text-gray-700">
                                            Show Page Title
                                        </label>
                                    </div>
                                    <div class="flex items-center">
                                        <input type="hidden" name="showFeaturedImage" value="false">
                                        <input type="checkbox" name="showFeaturedImage" id="showFeaturedImage"
                                            value="true"
                                            class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"
                                            checked>
                                        <label for="showFeaturedImage" class="ml-2 block text-sm text-gray-700">
                                            Show Featured Image
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Page Attributes -->
                            <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
                                <div class="bg-gray-50 px-4 py-3 border-b border-gray-200">
                                    <h3 class="font-semibold text-gray-700">Attributes</h3>
                                </div>
                                <div class="p-4">
                                    <label for="slug" class="block text-sm font-medium text-gray-700 mb-1">Slug</label>
                                    <input type="text"
                                        class="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm text-gray-500"
                                        id="slug" name="slug" required
                                        value="<%= typeof input !== 'undefined' ? input.slug : '' %>">
                                    <p class="mt-1 text-xs text-gray-400">URL-friendly name.</p>
                                </div>
                            </div>

                            <!-- Featured Image -->
                            <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
                                <div class="bg-gray-50 px-4 py-3 border-b border-gray-200">
                                    <h3 class="font-semibold text-gray-700">Featured Image</h3>
                                </div>
                                <div class="p-4">
                                    <div class="space-y-3">
                                        <!-- Preview Area -->
                                        <div id="imagePreview"
                                            class="relative aspect-video w-full bg-gray-100 rounded-lg overflow-hidden border-2 border-dashed border-gray-300 flex items-center justify-center group hover:border-indigo-400 transition-colors">
                                            <i
                                                class="bi bi-image text-4xl text-gray-400 group-hover:text-indigo-400 transition-colors"></i>
                                        </div>

                                        <input type="hidden" name="featuredImage" id="featuredImage">
                                        <input type="file" id="image" name="image" class="hidden"
                                            onchange="previewFile()">

                                        <!-- Buttons -->
                                        <div class="grid grid-cols-2 gap-2">
                                            <button type="button" onclick="document.getElementById('image').click()"
                                                class="flex items-center justify-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors">
                                                <i class="bi bi-upload mr-2"></i> Upload
                                            </button>
                                            <button type="button" onclick="openMediaPicker(selectImageFromPicker)"
                                                class="flex items-center justify-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-indigo-700 bg-indigo-100 hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors">
                                                <i class="bi bi-images mr-2"></i> Library
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </form>

                <script>
                    // Simple slug generator
                    document.getElementById('title').addEventListener('input', function () {
                        const slug = this.value.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)+/g, '');
                        document.getElementById('slug').value = slug;
                    });
                </script>
            </div>

            <%- include('../../partials/media_picker') %>

                <script>
                    function selectImageFromPicker(url) {
                        document.getElementById('featuredImage').value = url;
                        document.getElementById('image').value = '';
                        document.getElementById('imagePreview').innerHTML = `<img src="${url}" class="w-full h-full object-cover">`;
                    }

                    function previewFile() {
                        const input = document.getElementById('image');
                        const file = input.files[0];
                        if (file) {
                            const reader = new FileReader();
                            reader.onload = function (e) {
                                document.getElementById('imagePreview').innerHTML = `<img src="${e.target.result}" class="w-full h-full object-cover">`;
                                document.getElementById('featuredImage').value = '';
                            }
                            reader.readAsDataURL(file);
                        }
                    }
                </script>

                <%- include('../../partials/footer') %>