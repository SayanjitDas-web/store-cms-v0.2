<%- include('../partials/header_frontend') %>

    <div class="container mx-auto px-6 py-12 flex-grow">
        <div class="max-w-6xl mx-auto">
            <h1 class="text-3xl font-bold text-gray-900 mb-8">My Account</h1>

            <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
                <!-- Sidebar -->
                <div class="lg:col-span-1 space-y-4">
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden sticky top-8">
                        <div class="p-6 text-center bg-gray-50 border-b border-gray-100">
                            <div
                                class="w-16 h-16 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center mx-auto mb-3 text-2xl font-bold">
                                <%= user.username.charAt(0).toUpperCase() %>
                            </div>
                            <h2 class="text-lg font-bold text-gray-900">
                                <%= user.username %>
                            </h2>
                            <p class="text-xs text-gray-500 truncate">
                                <%= user.email %>
                            </p>
                        </div>
                        <nav class="p-2 space-y-1">
                            <button onclick="switchTab('profile')" id="btn-profile"
                                class="tab-btn w-full flex items-center space-x-3 p-3 rounded-lg bg-indigo-50 text-indigo-700 font-medium transition-colors">
                                <i class="bi bi-person"></i>
                                <span>Profile Details</span>
                            </button>
                            <button onclick="switchTab('orders')" id="btn-orders"
                                class="tab-btn w-full flex items-center space-x-3 p-3 rounded-lg text-gray-600 hover:bg-gray-50 transition-colors">
                                <i class="bi bi-bag"></i>
                                <span>Order History</span>
                            </button>
                            <button onclick="switchTab('address')" id="btn-address"
                                class="tab-btn w-full flex items-center space-x-3 p-3 rounded-lg text-gray-600 hover:bg-gray-50 transition-colors">
                                <i class="bi bi-geo-alt"></i>
                                <span>Shipping Address</span>
                            </button>
                            <div class="pt-2 mt-2 border-t border-gray-100">
                                <a href="/api/auth/logout"
                                    class="flex items-center space-x-3 p-3 rounded-lg text-red-600 hover:bg-red-50 transition-colors">
                                    <i class="bi bi-box-arrow-right"></i>
                                    <span>Logout</span>
                                </a>
                            </div>
                        </nav>
                    </div>
                </div>

                <!-- Main Content -->
                <div class="lg:col-span-3">

                    <!-- Success Alert -->
                    <script>
                        const urlParams = new URLSearchParams(window.location.search);
                        if (urlParams.has('updated')) {
                            document.write(`
                            <div class="mb-6 p-4 bg-green-50 border border-green-200 text-green-700 rounded-lg flex items-center">
                                <i class="bi bi-check-circle-fill mr-2"></i>
                                Settings updated successfully!
                            </div>
                        `);
                        }
                    </script>

                    <!-- Profile Tab -->
                    <div id="tab-profile" class="tab-content space-y-8">
                        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-8">
                            <h3 class="text-xl font-bold text-gray-900 mb-6 border-b pb-4">Personal Information</h3>
                            <form action="/customer/profile/update" method="POST" class="space-y-6">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                                        <input type="text" name="username" value="<%= user.username %>" required
                                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition-all">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Email
                                            Address</label>
                                        <input type="email" name="email" value="<%= user.email %>" required
                                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition-all">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">First Name</label>
                                        <input type="text" name="firstName" value="<%= user.firstName || '' %>"
                                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition-all">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Last Name</label>
                                        <input type="text" name="lastName" value="<%= user.lastName || '' %>"
                                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition-all">
                                    </div>
                                    <div class="md:col-span-2">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
                                        <input type="tel" name="phone" value="<%= user.phone || '' %>"
                                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition-all">
                                    </div>

                                </div>
                                <div class="flex justify-end">
                                    <button type="submit"
                                        class="bg-indigo-600 text-white font-semibold py-2.5 px-6 rounded-lg hover:bg-indigo-700 transition-colors shadow-md">
                                        Update Profile
                                    </button>
                                </div>
                            </form>
                        </div>

                        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-8">
                            <h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wider mb-4">Account
                                Metadata</h3>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-xs font-medium text-gray-500 mb-1">Customer Since</label>
                                    <p class="text-gray-900 font-medium">
                                        <%= new Date(user.createdAt).toLocaleDateString(undefined, { year: 'numeric' ,
                                            month: 'long' , day: 'numeric' }) %>
                                    </p>
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-gray-500 mb-1">Account Role</label>
                                    <span
                                        class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 capitalize">
                                        <%= user.role %>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Orders Tab -->
                    <div id="tab-orders" class="tab-content hidden space-y-6">
                        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-8">
                            <h3 class="text-xl font-bold text-gray-900 mb-6 border-b pb-4">Order History</h3>
                            <% if (orders && orders.length> 0) { %>
                                <div class="overflow-x-auto">
                                    <table class="w-full">
                                        <thead>
                                            <tr
                                                class="text-left text-xs font-semibold text-gray-400 uppercase tracking-wider">
                                                <th class="pb-4">Order ID</th>
                                                <th class="pb-4">Date</th>
                                                <th class="pb-4">Total</th>
                                                <th class="pb-4">Status</th>
                                                <th class="pb-4">Action</th>
                                            </tr>
                                        </thead>
                                        <tbody class="divide-y divide-gray-100">
                                            <% orders.forEach(order=> { %>
                                                <tr>
                                                    <td class="py-4 text-sm font-medium text-gray-900">#<%=
                                                            order._id.toString().substring(18).toUpperCase() %>
                                                    </td>
                                                    <td class="py-4 text-sm text-gray-600">
                                                        <%= new Date(order.createdAt).toLocaleDateString() %>
                                                    </td>
                                                    <td class="py-4 text-sm font-bold text-indigo-600">$<%=
                                                            order.totalAmount.toFixed(2) %>
                                                    </td>
                                                    <td class="py-4">
                                                        <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium 
                                                        <%= order.status === 'completed' ? 'bg-green-100 text-green-800' : 
                                                            order.status === 'pending' ? 'bg-yellow-100 text-yellow-800' : 
                                                            'bg-gray-100 text-gray-800' %>">
                                                            <%= order.status %>
                                                        </span>
                                                    </td>
                                                    <td class="py-4">
                                                        <a href="/shop/order/success/<%= order._id %>"
                                                            class="text-indigo-600 hover:text-indigo-800 text-sm font-semibold">View
                                                            Details</a>
                                                    </td>
                                                </tr>
                                                <% }) %>
                                        </tbody>
                                    </table>
                                </div>
                                <% } else { %>
                                    <div class="text-center py-12">
                                        <div
                                            class="w-16 h-16 bg-gray-50 text-gray-300 rounded-full flex items-center justify-center mx-auto mb-4">
                                            <i class="bi bi-cart-x text-3xl"></i>
                                        </div>
                                        <p class="text-gray-500">You haven't placed any orders yet.</p>
                                        <a href="/shop"
                                            class="inline-block mt-4 text-indigo-600 font-semibold hover:underline">Start
                                            Shopping</a>
                                    </div>
                                    <% } %>
                        </div>
                    </div>

                    <!-- Address Tab -->
                    <div id="tab-address" class="tab-content hidden">
                        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-8">
                            <h3 class="text-xl font-bold text-gray-900 mb-6 border-b pb-4">Shipping Address</h3>
                            <form action="/customer/profile/address" method="POST" class="space-y-6">
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Street
                                            Address</label>
                                        <input type="text" name="street"
                                            value="<%= user.address ? user.address.street : '' %>"
                                            placeholder="123 Example Street"
                                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition-all">
                                    </div>
                                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                                        <div class="col-span-2 md:col-span-1">
                                            <label class="block text-sm font-medium text-gray-700 mb-1">City</label>
                                            <input type="text" name="city"
                                                value="<%= user.address ? user.address.city : '' %>"
                                                placeholder="London"
                                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition-all">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">State /
                                                Prov</label>
                                            <input type="text" name="state"
                                                value="<%= user.address ? user.address.state : '' %>"
                                                placeholder="Greater London"
                                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition-all">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Pincode</label>
                                            <input type="text" name="pincode"
                                                value="<%= user.address ? user.address.pincode : '' %>"
                                                placeholder="110001"
                                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition-all">
                                        </div>

                                    </div>
                                </div>
                                <div class="flex justify-end pt-4">
                                    <button type="submit"
                                        class="bg-indigo-600 text-white font-semibold py-2.5 px-8 rounded-lg hover:bg-indigo-700 transition-colors shadow-md">
                                        Save Address
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <script>
        function switchTab(tabId) {
            // Hide all content
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            // Show selected content
            document.getElementById('tab-' + tabId).classList.remove('hidden');

            // Reset all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('bg-indigo-50', 'text-indigo-700', 'font-medium');
                btn.classList.add('text-gray-600');
            });
            // Highlight selected button
            const activeBtn = document.getElementById('btn-' + tabId);
            activeBtn.classList.add('bg-indigo-50', 'text-indigo-700', 'font-medium');
            activeBtn.classList.remove('text-gray-600');
        }
    </script>

    <%- include('../partials/footer_frontend') %>